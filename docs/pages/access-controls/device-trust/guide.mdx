---
title: Getting Started with Device Trust (Preview)
description: Get started with Teleport Device Trust
videoBanner: gBQyj_X1LVw
---

<Admonition type="warning">
  Device Trust is currently in Preview mode and supports following components:

  - User devices: macOS.
  - Teleport client: `tsh` and Teleport connect.
  - Resources: SSH, Database and Kubernetes.

  Support for Windows device is available in version 13.0 and above.

  Support for other operating systems, access from Web UI and application
  access is planned for upcoming Teleport versions.
</Admonition>

Device Trust requires two of the following steps to have been configured:

- Device enforcement mode configured via either a role or a cluster-wide config.
- Trusted device registered and enrolled with Teleport.

In this guide, you will update the preset `access` role to enforce Device Trust
and then enroll a trusted device into Teleport to access a resource (a test linux server)
protected with Teleport.

### Prerequisites

(!docs/pages/includes/no-oss-prereqs-tabs.mdx!)

(!docs/pages/includes/device-trust/prereqs.mdx!)

- User with `editor` role.
  ```code
  $ tsh status
  > Profile URL:      (=clusterDefaults.clusterName=):443
  Logged in as:       (=clusterDefaults.username=)
  Cluster:            (=clusterDefaults.clusterName=)
  Roles:              access, auditor, editor
  Logins:             root, ubuntu, ec2-user
  Kubernetes:         disabled
  Valid until:        2023-08-22 03:30:24 -0400 EDT [valid for 11h52m0s]
  Extensions:         login-ip, permit-agent-forwarding, permit-port-forwarding, permit-pty, private-key-policy
  ```
- Access to a linux server (any Linux server you can access via `tsh ssh` will do).
  ```code
  $ tsh ls
  Node Name        Address        Labels
  ---------------- -------------- --------------------------------------
  (=clusterDefaults.nodeIP=) ‚üµ Tunnel

  # test connection to (=clusterDefaults.nodeIP=)
  $ tsh ssh root@(=clusterDefaults.nodeIP=)
  root@(=clusterDefaults.nodeIP=):~#
  ```

Once the above prerequisites are met, begin with the following step.

## Step 1/2. Update role to enforce Device Trust

To enforce Device Trust, a user must be assigned with a role with Device Trust mode "required".

For simplicity, the example below updates the preset `access` role but you can update
any existing access granting role which the user is assigned with to enforce Device Trust.

<Admonition type="warning" title="Device Role">
  To avoid access disruption for other users assigned with preset `access` role, you can
  create a separate `require-trusted-device` role and use that role for this guide.
</Admonition>

First, using `tctl`, open the `access` role to edit it locally:
```code
$ tctl edit role/access
```

Edit the role with device trust mode:
```diff
kind: role
metadata:
  labels:
    teleport.internal/resource-type: preset
  name: access
spec:
  allow:
    logins:
    - '{{internal.logins}}'
    ...
  options:
    # require authenticated device check for this role
+   device_trust_mode: "required" # add this line
    ...
  deny:
    ...

```

Save your edits.

Now that the `access` role is configured with device mode "required", users with
this role will be enforced with Device Trust.

```code
$ tsh logout; tsh login --proxy=(=clusterDefaults.clusterName=) --user=(=clusterDefaults.username=)
$ tsh ssh root@(=clusterDefaults.nodeIP=)
ERROR: access denied to root connecting to (=clusterDefaults.nodeIP=):0
```

As you can verify from the above step, access to `(=clusterDefaults.nodeIP=)` ssh server,
which was previously accessible, is now forbidden.

## Step 2/2. Enroll device

To access `(=clusterDefaults.nodeIP=)` server again, you will have to enroll your device.

First, register your device:

Replace the `$SERIAL` below with your macOS
device serial number (visible under Apple ->
"About This Mac" -> "Serial number", or use the command below).

```code
$ SERIAL="$(ioreg -c IOPlatformExpertDevice -d 2 | grep -i IOPlatformSerialNumber | awk -F'"' '{print $4}')"
$ tctl devices add --os=macos --asset-tag="$SERIAL"
Device (=devicetrust.asset_tag=)/macOS added to the inventory
```

View registered devices:

```code
$ tctl devices ls
Asset Tag    OS    Enroll Status Device ID
------------ ----- ------------- ------------------------------------
(=devicetrust.asset_tag=) macOS not enrolled  (=devicetrust.device_id=)
```

Create enrollment token for your device:

```code
$ tctl devices enroll --asset-tag="(=devicetrust.asset_tag=)"
Run the command below on device "(=devicetrust.asset_tag=)" to enroll it:
tsh device enroll --token=(=devicetrust.enroll_token=)
```

Now using `tsh`, enroll your device (use token printed above with `tctl devices enroll` command) :

```code
$ tsh device enroll --token=(=devicetrust.enroll_token=)
Device "(=devicetrust.asset_tag=)"/macOS enrolled
```

The device above is now a trusted device.

Relogin to fetch updated certificate with device extension:

```code
$ tsh logout; tsh login --proxy=(=clusterDefaults.clusterName=) --user=(=clusterDefaults.username=)

$ tsh status
> Profile URL:        (=clusterDefaults.clusterName=):443
  Logged in as:       (=clusterDefaults.username=)
  Cluster:            (=clusterDefaults.clusterName=):443
  Roles:              access, auditor, editor
  Logins:             root
  Kubernetes:         enabled
  Valid until:        2023-08-22 04:06:53 -0400 EDT [valid for 12h0m0s]
  Extensions:         login-ip, ... teleport-device-asset-tag, teleport-device-credential-id, teleport-device-id
```

The presence of the `teleport-device-*` extensions shows that the device was successfully authenticated.

Now, let's try to access server (`(=clusterDefaults.nodeIP=)`) again:

```bash
$ tsh ssh root@(=clusterDefaults.nodeIP=)
root@(=clusterDefaults.nodeIP=):~#
```

Congratulations! You have successfully configured a Trusted Device and accessed a resource protected with
Device Trust enforcement.

## Troubleshooting

(!docs/pages/includes/device-trust/enroll-troubleshooting.mdx!)

## Next steps

- [Device Management](./device-management.mdx)
- [Enforcing Device Trust](./enforcing-device-trust.mdx)